#I just like python 3's print function, can't remember why I used division though
from __future__ import print_function, division

import zipfile
import signal
import progressbar
from sys import argv,exit,stdout

""" Zipfile password cracker with dictionary attack """

#check for enough args
if len(argv) < 2:
    print("Usage: %s [zipfile] [wordlist]" % argv[0])
    exit(0)

#read wordlist and strip it an stuff
def read_wordlist(word_list):
    return [word for line in open(word_list, 'r') for word in line.rstrip('\n').split()]

#print a pretty progress bar just cause. :)
def display_progress(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1

#variables we need
filename = argv[1]
password = None
count = 0
line_num = display_progress(argv[2])

print("Trying dictionary attack.")
print("Words in list: %02d" % line_num)

#initialize progress bar
bar = progressbar.ProgressBar(maxval=line_num, \
        widgets=[progressbar.Bar('=', '[',']'), ' ', progressbar.Percentage()])
bar.start()

#start cracking and allow Ctrl-C
for i in read_wordlist(argv[2]):
    try: 
        count = count + 1
        bar.update(count)
        zip_ref = zipfile.ZipFile(filename, 'r')
        zip_ref.extractall(pwd=i)
        zip_ref.close()
        print("Password is %s" % i)
        exit(0)
    except (KeyboardInterrupt, SystemExit):
        raise
    except:
        pass

print("Could not find password.") #:(
