from __future__ import print_function, division

import zipfile
import signal
import progressbar
from sys import argv,exit,stdout

""" Zipfile password cracker with dictionary attack """

if len(argv) < 2:
    print("Usage: %s [zipfile] [wordlist]" % argv[0])
    exit(0)
    
def read_wordlist(word_list):
    return [word for line in open(word_list, 'r') for word in line.rstrip('\n').split()]

def display_progress(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1

filename = argv[1]
password = None
count = 0
line_num = display_progress(argv[2])

print("Trying dictionary attack.")
print("Words in list: %02d" % line_num)

bar = progressbar.ProgressBar(maxval=line_num, \
        widgets=[progressbar.Bar('=', '[',']'), ' ', progressbar.Percentage()])
bar.start()

for i in read_wordlist(argv[2]):
    try: 
        count = count + 1
        bar.update(count)
        zip_ref = zipfile.ZipFile(filename, 'r')
        zip_ref.extractall(pwd=i)
        zip_ref.close()
        print("Password is %s" % i)
        exit(0)
    except (KeyboardInterrupt, SystemExit):
        raise
    except:
        pass

print("Could not find password.")
